#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 检测 Windows 环境
if [ -n "$COMSPEC" ] || [ -n "$ComSpec" ]; then
  # Windows 环境下转移到 PowerShell 脚本
  if command -v powershell.exe >/dev/null 2>&1; then
    exec powershell.exe -NoProfile -ExecutionPolicy Bypass -File "$(dirname -- "$0")/post-commit.ps1"
  else
    echo "Windows 环境检测到，但 PowerShell 不可用"
  fi
else
  # 非 Windows 环境，使用原始的 shell 命令
  echo "正在将最新提交添加到 CHANGELOG..."
  npm run changelog:append

  # 如果 CHANGELOG 有更新，自动提交这些变更
  if git diff --quiet CHANGELOG.md CHANGELOG-zh.md; then
    echo "CHANGELOG 没有变化，跳过..."
  else
    echo "CHANGELOG 已更新，提交变更..."
    git add CHANGELOG.md CHANGELOG-zh.md
    git commit --amend --no-edit
  fi
fi 